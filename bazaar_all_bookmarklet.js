javascript:(()=>{const D=document,U=new URL(location.href),P=new DOMParser(),MAX=15,root=D.createElement('div');root.style.cssText='position:fixed;inset:8px;z-index:2147483647;background:#111c;color:#fff;border:1px solid #fff3;border-radius:12px;backdrop-filter:blur(6px);display:flex;flex-direction:column;overflow:hidden;font:14px/1.4 system-ui';root.innerHTML='<div style="display:flex;gap:8px;align-items:center;padding:10px 12px;border-bottom:1px solid #fff2"><b>バザー横断</b><span id=s style=opacity:.8>準備中…</span><div style=flex:1></div><button id=c style="border:1px solid #fff3;background:#0006;color:#fff;border-radius:10px;padding:6px 10px">閉じる</button></div><div id=b style="padding:10px 12px;overflow:auto"></div>';D.body.appendChild(root);c.onclick=()=>root.remove();const stat=t=>s.textContent=t;const sleep=ms=>new Promise(r=>setTimeout(r,ms));const rand=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;const post=(fm,rr,pg)=>fetch(U.pathname,{method:'POST',credentials:'include',headers:{'Content-Type':'application/x-www-form-urlencoded'},body:new URLSearchParams({cmd:'f',fm,rr,st:32,ad:0,ds:-1,pg}).toString()}).then(r=>r.text());const parse=(h,base)=>{const d=P.parseFromString(h,'text/html');const as=[...d.querySelectorAll('nav.block ul>li>a[href*="tm="]')];const items=as.map(a=>({tm:+new URL(a.href,base).searchParams.get('tm')||0,href:a.href,html:a.outerHTML}));const n=d.querySelector('nav.pager li.next a[href]:not(.disable)');return{items,next:n?n.href:null};};(async()=>{const all=[],seen=new Set();let done=0;for(let fm=1;fm<=4;fm++)for(let rr=1;rr<=4;rr++){done++;stat(`取得中 ${done}/16 (fm=${fm},rr=${rr})`);let pg=0,html,next;do{html=await post(fm,rr,pg);({items,next}=parse(html,location.href));items.forEach(i=>{if(!seen.has(i.href)){seen.add(i.href);all.push(i);}});await sleep(rand(150,350));pg++;}while(next&&pg<MAX);}stat(`整列中… ${all.length}件`);all.sort((a,b)=>b.tm-a.tm);b.innerHTML='<ul style="list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:8px"></ul>';const ul=b.firstChild;all.forEach(i=>{const li=D.createElement('li');li.style.cssText='background:#0006;border:1px solid #fff2;border-radius:12px;padding:8px';li.innerHTML=i.html;ul.appendChild(li);});stat(`完了 ${all.length}件`);})().catch(e=>stat('エラー '+e.message));})();